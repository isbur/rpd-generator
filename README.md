# Генератор РПД

## Google-related things

[Генерация РПД](https://drive.google.com/drive/folders/1Y1JV8WWMs5OEc961P4ue-lye6Ul0ST_g) — основная рабочая папка

[Выгрузка дисциплин из УП](https://docs.google.com/spreadsheets/d/1PiJMfviYI1utc4CaUD_RTg2sZOVtUm3MJQCKdOjoWZA/edit#gid=0) — основная таблица со скриптами, выполняющими всю чёрную работу. [Старая версия этой папки](https://drive.google.com/drive/u/0/folders/1vwloMcEt6jZ3hJuH8ROcSQBIXgu6VBUa).

## Age of Replit

Ранее разработка велась в Redhat hosted Eclipse Che, но они постоянно там что-то меняют, плюс в целом это довольно громоздкая конструкция, которая на бесплатном плане медленно грузится, поэтому теперь я решил перейти в более легковесный Replit, благо кажется, что базовые потребности в настройке окружения тут поддерживаются.

### Clasp

https://github.com/google/clasp – инструмент для переноса workflow разработки из браузера в произвольную IDE. Пакет `clasp` добавлен в проект через менеджер пакетов Replit.

#### Модификация `PATH`

Менеджер Replit добавляет пакеты локально, поэтому `./node_modules/.bin` надо добавить в `PATH`. Сделано это при помощи встроенного в Replit интерфейса "Secrets":
```json
{
  "PATH": "/home/runner/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/runner/rpd-generator/node_modules/.bin"
}
```
Это похоже на костыль, им и является. Конструкция, скорее всего, сломается при изменении значения `PATH` по умолчанию. Кажется, это можно покрыть тестом, но, конечно же, пофиг.

#### `clasp login`

```bash
clasp login --no-localhost
```
Создаёт файл `~/.clasprc.json`, в котором хранятся все данные для входа. Как я понимаю, это безопасно использовать в публичном репле, так как версионированию подвергается только содержимое папки проекта (в нашем случае, `rpd-generator`). Более того, если не коммитить подобный файл, расположенный внутри рабочей папки, и, соответственно, не пушить его на Гитхаб, то посторонним этот файл всё равно не будет доступен, так как история репла доступна только владельцу репла и, быть может, приглашённым коллабораторам - но никак не обычным пользователям, имеющим доступ к реплу по ссылке. При форках история реплов также не переносится.

Окружение в Replit эфемерно, поэтому создавать `.clasprc.json` необходимо при каждом запуске репла. Я попробовал частично обойти:

1. При помощи Secrets создал переменную окружения `CLASPRC`, в которую положил содержимое файла `.clasprc.json`, сгенерированного при первом логине.
2. У реплов есть конфигурационный файл `.replit`, среди опций настройки есть `onBoot` —— она позволяет запустить команду `bash` при запуске репла:
```toml
onBoot = """
echo $CLASPRC > ~/.clasprc.json
"""
```
Таким образом, необходимость использовать `clasp login` при каждом запуске репла отпадает. При устаревании токена необходимо вручную обновить содержимое `CLASPRC`.

#### Использование `clasp`

```bash
cd src
clasp open
clasp push
```

`clasp clone <script_ID>` – script_ID единый для всех `.gs` файлов, привязанных к spreadsheet

```
## RTD документация

Вынести в отдельный репл?
Где вообще makefile?

``` bash
make html

rm -rf /projects/rpd-generator-public/docs
mkdir /projects/rpd-generator-public/docs
cp -r /projects/rpd-generator/docs /projects/rpd-generator-public
```
